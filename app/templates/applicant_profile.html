<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Hồ sơ ứng viên - {{ applicant.user.full_name }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin:0; padding:0; }
        body { font-family:'Poppins', sans-serif; background:#f0f2f5; color:#333; }

        /* Header */
        header {
            position: sticky;
            top:0;
            background: linear-gradient(90deg,#4b7bec,#3867d6);
            padding:15px 30px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            color:#fff;
            z-index:100;
            box-shadow:0 4px 12px rgba(0,0,0,0.15);
        }
        header .brand { display:flex; align-items:center; gap:10px; font-weight:700; font-size:22px; }
        header a { color:#fff; text-decoration:none; font-weight:500; margin-left:15px; transition:0.3s; }
        header a:hover { text-decoration:underline; }

        /* Container */
        .container { max-width: 1200px; margin:30px auto; padding:0 20px; display:flex; gap:30px; flex-wrap:wrap; }

        /* Left Info Card */
        .info-card {
            flex:1 1 40%;
            background: linear-gradient(135deg,#e0eaff,#f7f9ff);
            border-radius:20px;
            box-shadow:0 15px 30px rgba(0,0,0,0.1);
            padding:30px;
            display:flex;
            flex-direction:column;
            align-items:center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .info-card:hover { transform: translateY(-5px); box-shadow:0 25px 40px rgba(0,0,0,0.15); }
        .info-card img {
            width:180px; height:180px;
            border-radius:50%;
            object-fit:cover;
            border:5px solid #3867d6;
            margin-bottom:20px;
            transition: transform 0.3s;
        }
        .info-card img:hover { transform: scale(1.05); }
        .info-card h2 { font-size:28px; font-weight:700; margin-bottom:10px; text-align:center; }
        .info-card p { font-size:16px; margin:6px 0; display:flex; align-items:center; gap:10px; color:#555; }
        .status-badge {
            display:inline-block;
            padding:6px 15px;
            border-radius:15px;
            font-weight:600;
            font-size:14px;
            margin-top:10px;
            color:#fff;
        }
        .status-pending { background:#f39c12; }
        .status-interview { background:#3498db; }
        .status-hired { background:#2ecc71; }

        /* Right Update Form */
        .update-form {
            flex:1 1 55%;
            background:#fff;
            border-radius:20px;
            box-shadow:0 15px 30px rgba(0,0,0,0.08);
            padding:30px;
            display:flex;
            flex-direction:column;
            gap:20px;
        }
        .update-form h2 { color:#3867d6; margin-bottom:15px; font-weight:700; font-size:22px; border-bottom:2px solid #3867d6; display:inline-block; padding-bottom:5px; }
        .update-form form { display:flex; flex-direction:column; gap:15px; }
        .update-form .form-group { position:relative; }
        .update-form label {
            position:absolute;
            top:14px;
            left:15px;
            color:#999;
            font-size:14px;
            pointer-events:none;
            transition:0.3s;
        }
        .update-form input:focus + label,
        .update-form input:not(:placeholder-shown) + label {
            top:-10px;
            left:10px;
            font-size:12px;
            color:#3867d6;
            background:#fff;
            padding:0 4px;
        }
        .update-form input {
            width:100%;
            padding:14px 15px;
            border-radius:8px;
            border:1px solid #ccc;
            font-size:16px;
            outline:none;
        }
        .update-form input:focus { border-color:#3867d6; box-shadow:0 0 8px rgba(56,103,214,0.3); }

        .update-form button {
            padding:14px 25px;
            font-weight:700;
            font-size:16px;
            border:none;
            border-radius:10px;
            background: linear-gradient(90deg,#4b7bec,#3867d6);
            color:#fff;
            cursor:pointer;
            transition:0.3s;
        }
        .update-form button:hover { background: linear-gradient(90deg,#3867d6,#4b7bec); transform:scale(1.02); }

        /* Gallery */
        .image-gallery { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:15px; }
        .image-card { border-radius:12px; overflow:hidden; box-shadow:0 8px 20px rgba(0,0,0,0.08); position:relative; transition:transform 0.3s, box-shadow 0.3s; }
        .image-card img { width:100%; height:140px; object-fit:cover; display:block; }
        .image-card:hover { transform:scale(1.05); box-shadow:0 20px 30px rgba(0,0,0,0.15); }
        .image-card small {
            position:absolute;
            bottom:5px;
            left:50%;
            transform:translateX(-50%);
            background:rgba(0,0,0,0.6);
            color:#fff;
            padding:3px 6px;
            border-radius:6px;
            font-size:12px;
        }

        /* CV link */
        .cv-link a {
            display:inline-block;
            padding:12px 25px;
            border-radius:10px;
            background: linear-gradient(90deg,#20bf6b,#2bcbba);
            color:#fff;
            font-weight:700;
            text-decoration:none;
            transition:0.3s;
        }
        .cv-link a:hover { background: linear-gradient(90deg,#2bcbba,#20bf6b); transform:scale(1.05); }

        @media(max-width:992px){
            .container { flex-direction:column; }
            .info-card, .update-form { flex:1 1 100%; }
        }
    </style>
</head>
<body>
<header>
    <div class="brand"><i class="fas fa-user-circle"></i> Hồ sơ ứng viên</div>
    <div>
        {{ applicant.user.full_name }} |
        <a href="{{ url_for('main.index') }}"><i class="fas fa-home"></i> Trang chủ</a>
        <a href="{{ url_for('main.logout') }}"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
    </div>
</header>

<div class="container">
    <!-- Left Info Card -->
    <div class="info-card">
        <img id="avatarPreview" src="{{ avatar_url }}" alt="Avatar">
        <h2>{{ applicant.user.full_name }}</h2>
        <p><i class="fas fa-envelope"></i> {{ applicant.user.email }}</p>
        {% if applicant.user.phone %}
        <p><i class="fas fa-phone"></i> {{ applicant.user.phone }}</p>
        {% endif %}
        {% if applicant.user.address %}
        <p><i class="fas fa-map-marker-alt"></i> {{ applicant.user.address }}</p>
        {% endif %}
        {% if applicant.user.birth_date %}
        <p><i class="fas fa-birthday-cake"></i> Ngày sinh: {{ applicant.user.birth_date.strftime('%d-%m-%Y') }}</p>
        {% endif %}
        {% if applicant.user.hometown %}
        <p><i class="fas fa-city"></i> Quê quán: {{ applicant.user.hometown }}</p>
        {% endif %}
        <p><i class="fas fa-briefcase"></i> Vị trí ứng tuyển: {{ applicant.position_applied or 'Chưa cập nhật' }}</p>
        <p><i class="fas fa-user-tag"></i> Vai trò: {{ applicant.user.role }}</p>
        <p><i class="fas fa-calendar-alt"></i> Ngày đăng ký: {{ applicant.user.created_at.strftime('%d-%m-%Y') }}</p>
        <span class="status-badge 
            {% if applicant.status=='Đang xử lý' %}status-pending{% elif applicant.status=='Đã phỏng vấn' %}status-interview{% else %}status-hired{% endif %}">
            {{ applicant.status }}
        </span>
    </div>

    <!-- Right Update Form -->
    <div class="update-form">
        <h2>Cập nhật hồ sơ & Upload</h2>
        <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <input type="text" name="phone_number" placeholder=" " value="{{ applicant.phone_number or '' }}">
                <label>Số điện thoại ứng viên</label>
            </div>
            <div class="form-group">
                <input type="text" name="position_applied" placeholder=" " value="{{ applicant.position_applied or '' }}">
                <label>Vị trí ứng tuyển</label>
            </div>
            <div class="form-group">
                <input type="file" name="avatar_file" id="avatar_file" accept="image/*">
                <label>Chọn ảnh đại diện</label>
            </div>
            <div class="form-group">
                <input type="file" name="cv_file" id="cv_file" accept=".pdf,.doc,.docx">
                <label>Chọn CV (PDF/DOC)</label>
            </div>
            <button type="submit"><i class="fas fa-save"></i> Cập nhật</button>
        </form>

        <!-- Image Gallery -->
        <section>
            <h2>Ảnh đại diện / ảnh khác</h2>
            {% if user_images %}
            <div class="image-gallery">
                {% for img in user_images %}
                <div class="image-card">
                    <img src="{{ img.image_url }}" alt="Ảnh {{ loop.index }}">
                    <small>{{ img.uploaded_at.strftime('%d-%m-%Y %H:%M') }}</small>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Chưa có ảnh nào được tải lên.</p>
            {% endif %}
        </section>

        <!-- CV Section -->
        <section>
            <h2>CV hiện tại</h2>
            <div class="cv-link">
                {% if applicant.resume_url %}
                    <a href="{{ applicant.resume_url }}" target="_blank"><i class="fas fa-file-pdf"></i> Xem / Tải CV</a>
                {% else %}
                    <p>Chưa có CV.</p>
                {% endif %}
            </div>
        </section>
    </div>
</div>

<script>
    // Preview avatar trước khi upload
    const avatarInput = document.getElementById('avatar_file');
    const avatarPreview = document.getElementById('avatarPreview');
    avatarInput.addEventListener('change', function(){
        if(this.files && this.files[0]){
            const reader = new FileReader();
            reader.onload = function(e){
                avatarPreview.src = e.target.result;
            }
            reader.readAsDataURL(this.files[0]);
        }
    });
</script>
</body>
</html>
