<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hồ sơ ứng viên | OF GROUP 7</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='index/css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='index/css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='index/fonts/icomoon/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='index/fonts/flaticon/font/flaticon.css') }}">
  <style>
    body {
      background-color: #f5f6fa;
    }

    .card {
      border-radius: 10px;
    }

    .cv-preview iframe {
      width: 100%;
      height: 500px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .file-info {
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <header class="site-navbar mt-3">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-6 col-xl-2">
          <h1 class="mb-0"><a href="{{ url_for('main.index') }}" class="text-black h2 mb-0">
            <span class="text-primary">GROUP 7</span></a></h1>
        </div>

        <div class="col-10 col-xl-10 d-flex justify-content-end align-items-center">
          {% if current_user.is_authenticated %}
            <span class="mr-3 text-dark">Xin chào, <strong>{{ current_user.full_name }}</strong></span>
            <a href="{{ url_for('main.logout') }}" class="btn btn-outline-primary btn-sm">Đăng xuất</a>
          {% else %}
            <a href="{{ url_for('main.login') }}" class="btn btn-primary btn-sm mr-2">Đăng nhập</a>
            <a href="{{ url_for('main.register') }}" class="btn btn-outline-primary btn-sm">Đăng ký</a>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="section-hero overlay inner-page bg-image"
    style="background-image: url('{{ url_for('static', filename='img/Nen-anh-ho- so- quan-trong.jpg') }}'); height:200px;">
    <div class="container text-center">
      <div class="row justify-content-center align-items-center">
        <div class="col-md-10">
          <h2 class="text-white font-weight-bold mt-5">Hồ sơ ứng viên</h2>
        </div>
      </div>
    </div>
  </section>

  <!-- Profile Section -->
  <section class="site-section pb-5">
    <div class="container">
      <div class="row">
        <!-- Left: Avatar + Info -->
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm border-0">
            <div class="card-body text-center">
              <img src="{{ avatar_url }}" alt="Avatar" class="img-fluid rounded-circle mb-3"
                style="width:150px;height:150px;object-fit:cover;">
              <h4 class="text-dark mb-0">{{ applicant.user.full_name }}</h4>
              <p class="text-muted mb-2">{{ applicant.user.email }}</p>

              {% if applicant.position_applied %}
                <p><strong>Vị trí ứng tuyển:</strong> {{ applicant.position_applied }}</p>
              {% else %}
                <p class="text-muted">Chưa có vị trí ứng tuyển</p>
              {% endif %}

              {% if applicant.resume_url %}
                <div class="file-info mt-2">
                  <i class="icon-file mr-1"></i>
                  <strong>CV:</strong>
                  <a href="{{ applicant.resume_url }}" target="_blank">
                    {{ applicant.resume_url.split('/')[-1] }}
                  </a>
                </div>

                <button type="button" class="btn btn-outline-primary btn-sm mt-3"
                        data-bs-toggle="modal" data-bs-target="#cvModal">
                  <i class="icon-eye"></i> Xem CV
                </button>

              {% else %}
                <p class="text-muted mt-3">Chưa tải lên CV</p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Right: Form update -->
        <div class="col-md-8">
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
              <h5 class="card-title text-primary font-weight-bold mb-4">Cập nhật thông tin cá nhân</h5>
              <form method="POST" enctype="multipart/form-data">
                <div class="form-group mb-3">
                  <label for="email" class="font-weight-bold">Email liên hệ</label>
                  <input type="email" name="email" id="email" value="{{ applicant.user.email }}"
                    class="form-control" placeholder="Nhập email liên hệ">
                </div>

                <div class="form-group mb-3">
                  <label for="phone_number" class="font-weight-bold">Số điện thoại</label>
                  <input type="text" name="phone_number" id="phone_number"
                    value="{{ applicant.phone_number or '' }}" class="form-control" placeholder="Nhập số điện thoại">
                </div>

                <div class="form-group mb-3">
                  <label for="position_applied" class="font-weight-bold">Vị trí ứng tuyển</label>
                  <input type="text" name="position_applied" id="position_applied"
                    value="{{ applicant.position_applied or '' }}" class="form-control"
                    placeholder="Nhập vị trí bạn muốn ứng tuyển">
                </div>

                <div class="form-group mb-3">
                  <label for="cv_file" class="font-weight-bold">Cập nhật CV</label>
                  <input type="file" name="cv_file" id="cv_file" class="form-control-file">
                  {% if applicant.resume_url %}
                    <small class="text-muted">
                      CV hiện tại:
                      <a href="{{ applicant.resume_url }}" target="_blank">{{ applicant.resume_url.split('/')[-1] }}</a>
                    </small>
                  {% endif %}
                </div>

                <div class="form-group mb-4">
                  <label for="avatar_file" class="font-weight-bold">Cập nhật ảnh đại diện</label>
                  <input type="file" name="avatar_file" id="avatar_file" class="form-control-file">
                </div>

                <button type="submit" class="btn btn-primary px-4">
                  <i class="icon-save"></i> Lưu thay đổi
                </button>
              </form>
            </div>
          </div>

          <div class="text-right">
            <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary btn-sm">
              <i class="icon-arrow-left"></i> Quay lại trang chủ
            </a>
          </div>
        </div>
      </div>

      <!-- CV Modal -->
      <div class="modal fade" id="cvModal" tabindex="-1" role="dialog" aria-labelledby="cvModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="cvModalLabel">Xem CV của bạn</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Đóng">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body cv-preview">
              {% if applicant.resume_url %}
                {% set ext = applicant.resume_url.split('.')[-1].lower() %}
                {% if ext == 'pdf' %}
                  <iframe src="{{ applicant.resume_url }}" frameborder="0"></iframe>
                {% elif ext in ['doc', 'docx'] %}
                  <iframe src="https://view.officeapps.live.com/op/embed.aspx?src={{ request.host_url[:-1] + applicant.resume_url }}" frameborder="0"></iframe>
                {% else %}
                  <p class="text-muted text-center">
                    Định dạng CV không thể hiển thị trực tiếp.
                    <a href="{{ applicant.resume_url }}" target="_blank">Tải xuống tại đây</a>.
                  </p>
                {% endif %}
              {% else %}
                <p class="text-muted text-center">Chưa có CV để hiển thị.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="site-footer border-top">
    <div class="container text-center py-3">
      <p class="text-muted mb-0">DỰ ÁN NHÓM 7 - CÔNG NGHỆ PHẦN MỀM</p>
    </div>
  </footer>

  <!-- JS -->
  <script src="{{ url_for('static', filename='index/js/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='index/js/bootstrap.bundle.min.js') }}"></script>
</body>

</html>
