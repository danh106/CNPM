{% extends "admin/layout.html" %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">‚úçÔ∏è Th√™m Tin Tuy·ªÉn D·ª•ng M·ªõi</h1>
    <div class="card shadow mb-4">
        <div class="card-body">
            <form method="POST" id="jobForm">
                
                <div class="mb-3">
                    <label for="title"><strong>Ti√™u ƒë·ªÅ v·ªã tr√≠</strong> <span class="text-danger">*</span></label>
                    <input type="text" id="title" name="title" class="form-control" required placeholder="V√≠ d·ª•: L·∫≠p tr√¨nh vi√™n Backend (Python/Django)">
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="salary_range">M·ª©c l∆∞∆°ng d·ª± ki·∫øn</label>
                        <input type="text" id="salary_range" name="salary_range" class="form-control" placeholder="V√≠ d·ª•: 15 - 25 Tri·ªáu VND">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="location">ƒê·ªãa ƒëi·ªÉm l√†m vi·ªác</label>
                        <input type="text" id="location" name="location" class="form-control" placeholder="V√≠ d·ª•: Qu·∫≠n 1, TP. H·ªì Ch√≠ Minh">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="job_type">Lo·∫°i h√¨nh c√¥ng vi·ªác</label>
                        <input type="text" id="job_type" name="job_type" class="form-control" placeholder="V√≠ d·ª•: Full-time">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="vacancy">S·ªë l∆∞·ª£ng tuy·ªÉn</label>
                        <input type="number" id="vacancy" name="vacancy" class="form-control" min="1" value="1" placeholder="1">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="deadline">H·∫°n n·ªôp h·ªì s∆°</label>
                        <input type="date" id="deadline" name="deadline" class="form-control">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="description"><strong>M√¥ t·∫£ c√¥ng vi·ªác</strong> <span class="text-danger">*</span></label>
                            <textarea id="description" name="" class="form-control" rows="8" required placeholder="Chi ti·∫øt c√¥ng vi·ªác v√† m√¥i tr∆∞·ªùng l√†m vi·ªác..."></textarea>
                            <textarea class="d-none" name="description" id="te1"></textarea> 
                        </div>
                        <div class="mb-3">
                            <label for="responsibilities">Tr√°ch nhi·ªám ch√≠nh</label>
                            <textarea id="responsibilities" name="responsibilities" class="form-control" rows="4" placeholder="Li·ªát k√™ c√°c ƒë·∫ßu vi·ªác ch√≠nh (m·ªói m·ª•c m·ªôt d√≤ng)..."></textarea>
                            <textarea class="d-none" name="description" id="te2"></textarea> 
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="requirements">Y√™u c·∫ßu ·ª©ng vi√™n</label>
                            <textarea id="requirements" name="requirements" class="form-control" rows="4" placeholder="K·ªπ nƒÉng, kinh nghi·ªám b·∫Øt bu·ªôc..."></textarea>
                            <textarea class="d-none" name="description" id="te3"></textarea> 
                        </div>
                        <div class="mb-3">
                            <label for="benefits">Ph√∫c l·ª£i / Quy·ªÅn l·ª£i</label>
                            <textarea id="benefits" name="benefits" class="form-control" rows="4" placeholder="L∆∞∆°ng th√°ng 13, b·∫£o hi·ªÉm, du l·ªãch..."></textarea>
                            <textarea class="d-none" name="description" id="te4"></textarea> 
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="mb-3">
                    <label for="created_by">Ng∆∞·ªùi ƒëƒÉng tin</label>
                    <select id="created_by" name="created_by" class="form-control">
                        {% for user in users %}
                            {% if user.role in ['recruiter', 'admin'] %}
                                <option value="{{ user.id }}">{{ user.full_name }} ({{ user.role }})</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                   <div class="col-md-6 mb-3">
                        <label for="duration_days">Th·ªùi h·∫°n ƒëƒÉng tin (Ng√†y)</label>
                        <input type="number" id="duration_days" name="duration_days" class="form-control" min="1" value="30">
                    </div>
                </div>

                <div class="mt-4 pt-2 border-top">
                    <button type="button" class="btn btn-success btn-lg" onclick="onsubmitForm()">üíæ Th√™m Tin Tuy·ªÉn D·ª•ng</button>
                    <a href="{{ url_for('admin.job_list') }}" class="btn btn-secondary btn-lg ml-2">H·ªßy B·ªè</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/41.2.1/classic/ckeditor.js"></script>
<script>
    const editors = {}; 

    document.addEventListener('DOMContentLoaded', function() {
        const editorFields = ['#description', '#responsibilities', '#requirements', '#benefits'];

        editorFields.forEach(id => {
            const element = document.querySelector(id);
            if (element) {
                // S·ª≠ d·ª•ng h√†m create v√† .then() ƒë·ªÉ l∆∞u ƒë·ªëi t∆∞·ª£ng editor
                ClassicEditor.create(element)
                    .then(editor => {
                        const fieldName = id.substring(1); 
                        editors[fieldName] = editor; 
                        console.log(`CKEditor cho ${fieldName} ƒë√£ s·∫µn s√†ng.`);
                    })
                    .catch(error => console.error('L·ªói kh·ªüi t·∫°o CKEditor:', id, error));
            } else {
                console.warn('Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ cho CKEditor:', id);
            }
        });
    });
    
    function getEditorContent(fieldName) {
        if (editors[fieldName]) {
            return editors[fieldName].getData(); 
        }
        return null;
    }
    const descriptionHTML = getEditorContent('description');
    const requirementsHTML = getEditorContent('requirements');
    const benefitsHTML = getEditorContent('benefits');
    function onsubmitForm() {
        const descriptionHTML = getEditorContent('description');
        const responsibilitiesHTML = getEditorContent('responsibilities');
        const requirementsHTML = getEditorContent('requirements');
        const benefitsHTML = getEditorContent('benefits');

        document.getElementById('te1').value = descriptionHTML || '';
        document.getElementById('te2').value = responsibilitiesHTML || '';
        document.getElementById('te3').value = requirementsHTML || '';
        document.getElementById('te4').value = benefitsHTML || '';

        document.getElementById('jobForm').submit();
    }
</script>

{% endblock %}
